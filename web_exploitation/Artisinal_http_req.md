# Artisinal Handcrafted HTTP 3 - 300 points

We found a hidden flag server hiding behind a proxy, but the proxy has some... _interesting_ ideas of what qualifies someone to make HTTP requests. Looks like you'll have to do this one by hand. Try connecting via `nc 2018shell1.picoctf.com 42496`, and use the proxy to send HTTP requests to `flag.local`. We've also recovered a username and a password for you to use on the login page: `realbusinessuser`/`potoooooooo`.

Hint: _Be the browser._ When you navigate to a page, how does your browser send HTTP requests? How does this change when you submit a form?

### Solution
###### Writeup by asinggih

I tried to navigate to the given link on my browser, and it says that the page is not working. Went to my terminal, and nc'ed to the given address.

```sh
❯ nc 2018shell1.picoctf.com 42496
Real Business Corp., Internal Proxy
Version 2.0.7
To proceed, please solve the following captcha:

   ___            __
  /   |          /  |   ______
 / /| |  ______  `| |  |______|
/ /_| | |______|  | |   ______
\___  |          _| |_ |______|
    |_/          \___/




>
```

apparently there's a captcha to go into the proxy. After answering the captcha question, we can start creating the http request.
I modified one of the previously intercepted http requests on burpsuite, to fit the information provided in this challenge.


#### Request /
```sh
GET / HTTP/1.1
Host: flag.local
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Connection: close
```

#### Response of /
```sh
HTTP/1.1 200 OK
x-powered-by: Express
content-type: text/html; charset=utf-8
content-length: 321
etag: W/"141-LuTf9ny9p1l454tuA3Un+gDFLWo"
date: Tue, 20 Nov 2018 06:02:24 GMT
connection: close


		<html>
			<head>
				<link rel="stylesheet" type="text/css" href="main.css" />
			</head>
			<body>
				<header>
					<h1>Real Business Internal Flag Server</h1>
					<a href="/login">Login</a>
				</header>
				<main>
					<p>You need to log in before you can see today's flag.</p>
				</main>
			</body>
		</html>

```

From the response, we can see that there's a `/login` page in this website. Therefore, we should make a request towards that page, and see the response

#### Request /login
```sh
GET /login HTTP/1.1
Host: flag.local
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Connection: close
```

#### Response of /login
```sh
HTTP/1.1 200 OK
x-powered-by: Express
content-type: text/html; charset=utf-8
content-length: 498
etag: W/"1f2-UE5AGAqbLVQn1qrfKFRIqanxl9I"
date: Tue, 20 Nov 2018 06:07:03 GMT
connection: close


		<html>
			<head>
				<link rel="stylesheet" type="text/css" href="main.css" />
			</head>
			<body>
				<header>
					<h1>Real Business Internal Flag Server</h1>
					<a href="/login">Login</a>
				</header>
				<main>
					<h2>Log In</h2>

					<form method="POST" action="login">
						<input type="text" name="user" placeholder="Username" />
						<input type="password" name="pass" placeholder="Password" />
						<input type="submit" />
					</form>
				</main>
			</body>
		</html>

```

In the response, we can see that there's a login form that can be submitted. Again, i modified a previously intercepted POST request from burpsuite, to fit the required POST request.

#### Request (POST) to /login
```sh
POST /login HTTP/1.1
Host: flag.local
Content-Type: application/x-www-form-urlencoded
Content-Length: 38

user=realbusinessuser&pass=potoooooooo
``` 

#### Response of (POST) to /login
```sh
HTTP/1.1 302 Found
x-powered-by: Express
set-cookie: real_business_token=PHNjcmlwdD5hbGVydCgid2F0Iik8L3NjcmlwdD4%3D; Path=/
location: /
vary: Accept
content-type: text/plain; charset=utf-8
content-length: 23
date: Tue, 20 Nov 2018 07:05:27 GMT
connection: close

Found. Redirecting to /
```

From the response, we can see that the request is redirected to `/`, and we're also given a cookie that we should use when accessing `/`.
Therefore, we should create another http request to `/`, with the cookie embedded in our request.

#### Request / with previously obtained cookie embedded
```sh
GET / HTTP/1.1
Host: flag.local
Cookie:real_business_token=PHNjcmlwdD5hbGVydCgid2F0Iik8L3NjcmlwdD4%3D;
```

#### Response of / with previously obtained cookie embedded
```sh
HTTP/1.1 200 OK
x-powered-by: Express
content-type: text/html; charset=utf-8
content-length: 438
etag: W/"1b6-eYJ8DUTdkgByyfWFi6OJJSjopFg"
date: Tue, 20 Nov 2018 07:13:28 GMT
connection: close


		<html>
			<head>
				<link rel="stylesheet" type="text/css" href="main.css" />
			</head>
			<body>
				<header>
					<h1>Real Business Internal Flag Server</h1>
					<div class="user">Real Business Employee</div>
					<a href="/logout">Logout</a>
				</header>
				<main>
					<p>Hello <b>Real Business Employee</b>!  Today's flag is: <code>picoCTF{0nLY_Us3_n0N_GmO_xF3r_pR0tOcol5_2e14}</code>.</p>
				</main>
			</body>
		</html>
```

And voila!! we're logged in as a "Real Business Employee" who can see the flag.


## Flag
>picoCTF{0nLY_Us3_n0N_GmO_xF3r_pR0tOcol5_2e14}

